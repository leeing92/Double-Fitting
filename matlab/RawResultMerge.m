function MergeImg=RawResultMerge(RawImage,FWHMap,ColorRange)
%ColorRange [ColorMin,ColorMax]
%the colormap hot 
tic
    hotcdata=[0.0104166666666667,0,0;0.0208333333333333,0,0;0.0312500000000000,0,0;0.0416666666666667,0,0;0.0520833333333333,0,0;0.0625000000000000,0,0;0.0729166666666667,0,0;0.0833333333333333,0,0;0.0937500000000000,0,0;0.104166666666667,0,0;0.114583333333333,0,0;0.125000000000000,0,0;0.135416666666667,0,0;0.145833333333333,0,0;0.156250000000000,0,0;0.166666666666667,0,0;0.177083333333333,0,0;0.187500000000000,0,0;0.197916666666667,0,0;0.208333333333333,0,0;0.218750000000000,0,0;0.229166666666667,0,0;0.239583333333333,0,0;0.250000000000000,0,0;0.260416666666667,0,0;0.270833333333333,0,0;0.281250000000000,0,0;0.291666666666667,0,0;0.302083333333333,0,0;0.312500000000000,0,0;0.322916666666667,0,0;0.333333333333333,0,0;0.343750000000000,0,0;0.354166666666667,0,0;0.364583333333333,0,0;0.375000000000000,0,0;0.385416666666667,0,0;0.395833333333333,0,0;0.406250000000000,0,0;0.416666666666667,0,0;0.427083333333333,0,0;0.437500000000000,0,0;0.447916666666667,0,0;0.458333333333333,0,0;0.468750000000000,0,0;0.479166666666667,0,0;0.489583333333333,0,0;0.500000000000000,0,0;0.510416666666667,0,0;0.520833333333333,0,0;0.531250000000000,0,0;0.541666666666667,0,0;0.552083333333333,0,0;0.562500000000000,0,0;0.572916666666667,0,0;0.583333333333333,0,0;0.593750000000000,0,0;0.604166666666667,0,0;0.614583333333333,0,0;0.625000000000000,0,0;0.635416666666667,0,0;0.645833333333333,0,0;0.656250000000000,0,0;0.666666666666667,0,0;0.677083333333333,0,0;0.687500000000000,0,0;0.697916666666667,0,0;0.708333333333333,0,0;0.718750000000000,0,0;0.729166666666667,0,0;0.739583333333333,0,0;0.750000000000000,0,0;0.760416666666667,0,0;0.770833333333333,0,0;0.781250000000000,0,0;0.791666666666667,0,0;0.802083333333333,0,0;0.812500000000000,0,0;0.822916666666667,0,0;0.833333333333333,0,0;0.843750000000000,0,0;0.854166666666667,0,0;0.864583333333333,0,0;0.875000000000000,0,0;0.885416666666667,0,0;0.895833333333333,0,0;0.906250000000000,0,0;0.916666666666667,0,0;0.927083333333333,0,0;0.937500000000000,0,0;0.947916666666667,0,0;0.958333333333333,0,0;0.968750000000000,0,0;0.979166666666667,0,0;0.989583333333333,0,0;1,0,0;1,0.0104166666666667,0;1,0.0208333333333333,0;1,0.0312500000000000,0;1,0.0416666666666667,0;1,0.0520833333333333,0;1,0.0625000000000000,0;1,0.0729166666666667,0;1,0.0833333333333333,0;1,0.0937500000000000,0;1,0.104166666666667,0;1,0.114583333333333,0;1,0.125000000000000,0;1,0.135416666666667,0;1,0.145833333333333,0;1,0.156250000000000,0;1,0.166666666666667,0;1,0.177083333333333,0;1,0.187500000000000,0;1,0.197916666666667,0;1,0.208333333333333,0;1,0.218750000000000,0;1,0.229166666666667,0;1,0.239583333333333,0;1,0.250000000000000,0;1,0.260416666666667,0;1,0.270833333333333,0;1,0.281250000000000,0;1,0.291666666666667,0;1,0.302083333333333,0;1,0.312500000000000,0;1,0.322916666666667,0;1,0.333333333333333,0;1,0.343750000000000,0;1,0.354166666666667,0;1,0.364583333333333,0;1,0.375000000000000,0;1,0.385416666666667,0;1,0.395833333333333,0;1,0.406250000000000,0;1,0.416666666666667,0;1,0.427083333333333,0;1,0.437500000000000,0;1,0.447916666666667,0;1,0.458333333333333,0;1,0.468750000000000,0;1,0.479166666666667,0;1,0.489583333333333,0;1,0.500000000000000,0;1,0.510416666666667,0;1,0.520833333333333,0;1,0.531250000000000,0;1,0.541666666666667,0;1,0.552083333333333,0;1,0.562500000000000,0;1,0.572916666666667,0;1,0.583333333333333,0;1,0.593750000000000,0;1,0.604166666666667,0;1,0.614583333333333,0;1,0.625000000000000,0;1,0.635416666666667,0;1,0.645833333333333,0;1,0.656250000000000,0;1,0.666666666666667,0;1,0.677083333333333,0;1,0.687500000000000,0;1,0.697916666666667,0;1,0.708333333333333,0;1,0.718750000000000,0;1,0.729166666666667,0;1,0.739583333333333,0;1,0.750000000000000,0;1,0.760416666666667,0;1,0.770833333333333,0;1,0.781250000000000,0;1,0.791666666666667,0;1,0.802083333333333,0;1,0.812500000000000,0;1,0.822916666666667,0;1,0.833333333333333,0;1,0.843750000000000,0;1,0.854166666666667,0;1,0.864583333333333,0;1,0.875000000000000,0;1,0.885416666666667,0;1,0.895833333333333,0;1,0.906250000000000,0;1,0.916666666666667,0;1,0.927083333333333,0;1,0.937500000000000,0;1,0.947916666666667,0;1,0.958333333333333,0;1,0.968750000000000,0;1,0.979166666666667,0;1,0.989583333333333,0;1,1,0;1,1,0.0156250000000000;1,1,0.0312500000000000;1,1,0.0468750000000000;1,1,0.0625000000000000;1,1,0.0781250000000000;1,1,0.0937500000000000;1,1,0.109375000000000;1,1,0.125000000000000;1,1,0.140625000000000;1,1,0.156250000000000;1,1,0.171875000000000;1,1,0.187500000000000;1,1,0.203125000000000;1,1,0.218750000000000;1,1,0.234375000000000;1,1,0.250000000000000;1,1,0.265625000000000;1,1,0.281250000000000;1,1,0.296875000000000;1,1,0.312500000000000;1,1,0.328125000000000;1,1,0.343750000000000;1,1,0.359375000000000;1,1,0.375000000000000;1,1,0.390625000000000;1,1,0.406250000000000;1,1,0.421875000000000;1,1,0.437500000000000;1,1,0.453125000000000;1,1,0.468750000000000;1,1,0.484375000000000;1,1,0.500000000000000;1,1,0.515625000000000;1,1,0.531250000000000;1,1,0.546875000000000;1,1,0.562500000000000;1,1,0.578125000000000;1,1,0.593750000000000;1,1,0.609375000000000;1,1,0.625000000000000;1,1,0.640625000000000;1,1,0.656250000000000;1,1,0.671875000000000;1,1,0.687500000000000;1,1,0.703125000000000;1,1,0.718750000000000;1,1,0.734375000000000;1,1,0.750000000000000;1,1,0.765625000000000;1,1,0.781250000000000;1,1,0.796875000000000;1,1,0.812500000000000;1,1,0.828125000000000;1,1,0.843750000000000;1,1,0.859375000000000;1,1,0.875000000000000;1,1,0.890625000000000;1,1,0.906250000000000;1,1,0.921875000000000;1,1,0.937500000000000;1,1,0.953125000000000;1,1,0.968750000000000;1,1,0.984375000000000;1,1,1];
    RawImage=double(RawImage);
    %--------------
    TT=RawImage(RawImage~=0);
    [Try,Num]=histcounts(TT);
    Try=Try/sum(Try);
    TrySum=cumsum(Try);
    T=Num(TrySum>0.99);
    MergeRawImg=RawImage/(T(2));
    MergeRawImg(MergeRawImg>1)=1;
    %--------------------------------
%     MergeRawImg=Normalized(RawImage);
%      MergeRawImg=adapthisteq(RawImage,'clipLimit',0,'Distribution','rayleigh');
    OImgR=MergeRawImg;
    OImgG=MergeRawImg;
    OImgB=MergeRawImg;
    if isempty(ColorRange)
        NorFWHMap=Normalized(FWHMap);  
        FWHMapMax=max(FWHMap(:));
        FWHMapMin=min(FWHMap(:));
    else
        NorFWHMap=(FWHMap-ColorRange(1))/(ColorRange(2)-ColorRange(1));
        FWHMapMax=ColorRange(2);
        FWHMapMin=ColorRange(1);
    end
    Index1=(NorFWHMap<0) | (NorFWHMap==0);
    Index1=Index1 & FWHMap>0;
    OImgR(Index1)=hotcdata(1,1);
    OImgG(Index1)=hotcdata(1,2);
    OImgB(Index1)=hotcdata(1,3);
    
    Index2=NorFWHMap>1 | NorFWHMap==1;
    Index2=Index2 & FWHMap>0;
    OImgR(Index2)=hotcdata(256,1);
    OImgG(Index2)=hotcdata(256,2);
    OImgB(Index2)=hotcdata(256,3);
    
    for value=2:255
    Index3=round( 256*NorFWHMap)==value & ~Index1 & ~Index2;
    Index3=Index3 & FWHMap>0;
    OImgR( Index3)=hotcdata(value,1);
    OImgG( Index3)=hotcdata(value,2);
    OImgB( Index3)=hotcdata(value,3);
    end

    MergeImg=cat(3,OImgR,OImgG,OImgB);

    TickLabel=FWHMapMin:(FWHMapMax-FWHMapMin)/10:FWHMapMax;
    TickLabelRound=round(TickLabel);
    figure;imshow(MergeImg);colormap(hotcdata);
    str={num2str(TickLabelRound(1)),num2str(TickLabelRound(3)),num2str(TickLabelRound(5)),num2str(TickLabelRound(7)),num2str(TickLabelRound(9)),num2str(TickLabelRound(11))};
    colorbar('Ticks',[0 0.2 0.4 0.6 0.8 1],'TickLabels',str);
toc
end